/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_CreatedContextsCache","./Context","./ODataAnnotations","./ODataContextBinding","./ODataListBinding","./ODataTreeBinding","sap/base/assert","sap/base/Log","sap/base/i18n/Localization","sap/base/security/encodeURL","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/base/util/each","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/merge","sap/base/util/uid","sap/ui/base/SyncPromise","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageParser","sap/ui/core/message/MessageType","sap/ui/core/Supportability","sap/ui/model/_Helper","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/FilterProcessor","sap/ui/model/Model","sap/ui/model/odata/CountMode","sap/ui/model/odata/MessageScope","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataMetaModel","sap/ui/model/odata/ODataMessageParser","sap/ui/model/odata/ODataPropertyBinding","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/OperationMode","sap/ui/model/odata/UpdateMethod","sap/ui/thirdparty/datajs","sap/ui/thirdparty/URI","sap/ui/util/isCrossOriginURL"],function(e,t,a,s,r,n,i,o,d,u,h,f,c,p,l,g,_,m,y,v,b,C,P,q,M,R,E,S,T,x,A,U,I,D,O,k,H,B,L,F,w){"use strict";var G="sap.ui.model.odata.v2.ODataModel",j=["context","properties"],N={},W=["groupId","urlParameters"];N[P.Error]=0;N[P.Warning]=1;N[P.Success]=2;N[P.Information]=3;N[P.None]=4;var $=T.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(t,s){T.apply(this,arguments);var r,n,i,o,u,h,f,c,p,l,g,_,m,y,v,b,C,P,M,E,S,I,D,O,L,F,G,j,N,W,K,z=this;if(typeof t==="object"){s=t;this.sServiceUrl=s.serviceUrl}else{this.sServiceUrl=t}this.mCodeListModelParams=this.createCodeListModelParameters(s);if(s){r=s.user;n=s.password;i=s.headers;o=s.tokenHandling;u=s.withCredentials;h=s.maxDataServiceVersion;f=s.useBatch;c=s.refreshAfterChange;p=s.annotationURI;l=s.loadAnnotationsJoined;m=s.defaultBindingMode;g=s.defaultCountMode;_=s.preliminaryContext;y=s.defaultOperationMode;v=s.metadataNamespaces;b=s.serviceUrlParams;C=s.metadataUrlParams;P=s.json;M=s.messageParser;E=s.skipMetadataAnnotationParsing;S=s.defaultUpdateMethod;I=s.disableHeadRequestForToken;D=s.sequentializeRequests;O=s.disableSoftStateHeader;L=s.bindableResponseHeaders;F=s.warmupUrl;G=s.canonicalRequests;j=s.tokenHandlingForGet;N=s.earlyTokenRequest;W=s.persistTechnicalMessages;K=s.ignoreAnnotationsFromMetadata}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!G;this.bTokenHandlingForGet=!!j;this.sMessageScope=A.RequestedObjects;this.sWarmupUrl=F;this.bWarmup=!!F;this.mSupportedBindingModes={OneWay:true,OneTime:true,TwoWay:true};this.mUnsupportedFilterOperators={Any:true,All:true};this.sDefaultBindingMode=m||R.OneWay;this.bIsMessageScopeSupported=false;this.iPendingDeferredRequests=0;this.bJSON=P!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=S||B.Merge;this.bTokenHandling=o!==false;this.bWithCredentials=u===true;this.bUseBatch=f!==false;this.bRefreshAfterChange=c!==false;this.sMaxDataServiceVersion=h;this.bLoadAnnotationsJoined=l!==false;this.sAnnotationURI=p;this.sDefaultCountMode=g||x.Request;this.sDefaultOperationMode=y||H.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!E;this.bDisableHeadRequestForToken=!!I;this.bSequentializeRequests=!!D;this.bDisableSoftStateHeader=!!O;this.aBindableResponseHeaders=L?L:null;this.bPreliminaryContext=_||false;this.mMetadataUrlParams=C||{};this.mChangedEntities4checkUpdate={};this.bPersistTechnicalMessages=W===undefined?undefined:!!W;this.oCreatedContextsCache=new e;this.aSideEffectCleanUpFunctions=[];this.oTransitionMessagesOnlyGroups=new Set;this.bIgnoreAnnotationsFromMetadata=!!K;if(M){M.setProcessor(this)}this.oMessageParser=M;this.setDeferredGroups(["changes"]);this.setChangeGroups({"*":{groupId:"changes"}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();var Q=this.sServiceUrl.split("?");if(Q.length>1){this.sServiceUrl=Q[0];if(Q[1]){this.aUrlParams.push(Q[1])}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=r;this.sPassword=n;if(q.isStatisticsEnabled()){this.aUrlParams.push("sap-statistics=true")}this.oHeaders={};this.setHeaders(i);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header"}this.sMetadataUrl=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=o==="skipServerCache"?undefined:$._getSharedData("server",this._getServerUrl());this.oSharedServiceData=$._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=$._getSharedData("meta",this.sMetadataUrl);this.bUseCache=this._cacheSupported(this.sMetadataUrl);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new U(this.sMetadataUrl,{async:true,cacheKey:this.bUseCache?this.sMetadataUrl:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:v,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata}}else{this.oMetadata=this.oSharedMetaData.oMetadata}this.oAnnotations=new a(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing||this.bIgnoreAnnotationsFromMetadata,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(this.sMetadataUrl),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"]}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(b){this.aUrlParams=this.aUrlParams.concat(k._createUrlParamsArray(b))}this.onMetadataFailed=function(e){z.fireMetadataFailed(e.getParameters())};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed)}this.oMetadata.loaded().then(function(){z._initializeMetadata()});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata"}else{this.oHeaders["Accept"]="application/json"}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml"}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}else if(this.oSharedServerData&&this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}if(N){this.securityTokenAvailable()}}this.oHeaders["Accept-Language"]=d.getLanguageTag().toString();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion}if(!this.mCustomHeaders["X-Requested-With"]&&!w(this.sServiceUrl)){this.oHeaders["X-Requested-With"]="XMLHttpRequest"}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});$.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};$.prototype.attachBatchRequestFailed=function(e,t,a){this.attachEvent("batchRequestFailed",e,t,a);return this};$.prototype.detachBatchRequestFailed=function(e,t){this.detachEvent("batchRequestFailed",e,t);return this};$.prototype.fireBatchRequestFailed=function(e){this.fireEvent("batchRequestFailed",e);return this};$.prototype.attachBatchRequestSent=function(e,t,a){this.attachEvent("batchRequestSent",e,t,a);return this};$.prototype.detachBatchRequestSent=function(e,t){this.detachEvent("batchRequestSent",e,t);return this};$.prototype.fireBatchRequestSent=function(e){this.fireEvent("batchRequestSent",e);return this};$.prototype.attachBatchRequestCompleted=function(e,t,a){this.attachEvent("batchRequestCompleted",e,t,a);return this};$.prototype.detachBatchRequestCompleted=function(e,t){this.detachEvent("batchRequestCompleted",e,t);return this};$.prototype.fireBatchRequestCompleted=function(e){this.fireEvent("batchRequestCompleted",e);return this};$.mSharedData={server:{},service:{},meta:{}};$._getSharedData=function(e,t){var a=this.mSharedData[e][t];if(!a){a={};this.mSharedData[e][t]=a}return a};$.prototype._initializeMetadata=function(){if(this.bDestroyed){return}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var e=function(){this.fireMetadataLoaded({metadata:this.oMetadata});o.debug(this+" - metadataloaded fired")}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(e,this.fireMetadataFailed.bind(this))}else{e()}};$.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh()}return undefined};$.prototype.fireAnnotationsLoaded=function(e){this.fireEvent("annotationsLoaded",e);return this};$.prototype.attachAnnotationsLoaded=function(e,t,a){this.attachEvent("annotationsLoaded",e,t,a);return this};$.prototype.detachAnnotationsLoaded=function(e,t){this.detachEvent("annotationsLoaded",e,t);return this};$.prototype.fireAnnotationsFailed=function(e){this.fireEvent("annotationsFailed",e);o.debug(this+" - annotationsfailed fired");return this};$.prototype.attachAnnotationsFailed=function(e,t,a){this.attachEvent("annotationsFailed",e,t,a);return this};$.prototype.detachAnnotationsFailed=function(e,t){this.detachEvent("annotationsFailed",e,t);return this};$.prototype.fireMetadataLoaded=function(e){this.fireEvent("metadataLoaded",e);return this};$.prototype.attachMetadataLoaded=function(e,t,a){this.attachEvent("metadataLoaded",e,t,a);return this};$.prototype.detachMetadataLoaded=function(e,t){this.detachEvent("metadataLoaded",e,t);return this};$.prototype.fireMetadataFailed=function(e){this.fireEvent("metadataFailed",e);return this};$.prototype.attachMetadataFailed=function(e,t,a){this.attachEvent("metadataFailed",e,t,a);return this};$.prototype.detachMetadataFailed=function(e,t){this.detachEvent("metadataFailed",e,t);return this};$.prototype._createEventInfo=function(e,t,a){var s,r,n={};n.url=e.requestUri;n.method=e.method;n.async=e.async;n.headers=e.headers;if(a){n.requests=[];for(var i=0;i<a.length;i++){r={};if(Array.isArray(a[i])){var o=a[i];for(var d=0;d<o.length;d++){e=o[d].request;s=a[i][d].response;r={};r.url=e.requestUri;r.method=e.method;r.headers=e.headers;if(s){r.response={};if(e._aborted){r.success=false;r.response.statusCode=0;r.response.statusText="abort"}else{r.success=true;if(s.message){r.response.message=s.message;s=s.response;r.response.responseText=s.body;r.success=false}r.response.headers=s.headers;r.response.statusCode=s.statusCode;r.response.statusText=s.statusText}}n.requests.push(r)}}else{e=a[i].request;s=a[i].response;r.url=e.requestUri;r.method=e.method;r.headers=e.headers;if(s){r.response={};if(e._aborted){r.success=false;r.response.statusCode=0;r.response.statusText="abort"}else{r.success=true;if(s.message){r.response.message=s.message;s=s.response;r.response.responseText=s.body;r.success=false}r.response.headers=s.headers;r.response.statusCode=s.statusCode;r.response.statusText=s.statusText}}n.requests.push(r)}}}if(t){n.response={};n.success=true;if(t.message){n.response.message=t.message;n.success=false}if(t.response){t=t.response}if(t&&t.statusCode!=undefined){n.response.headers=t.headers;n.response.statusCode=t.statusCode;n.response.statusText=t.statusText;n.response.responseText=t.body!==undefined?t.body:t.responseText;if(t.expandAfterCreateFailed){n.response.expandAfterCreateFailed=true}if(t.expandAfterFunctionCallFailed){n.response.expandAfterFunctionCallFailed=true}}}n.ID=e.requestID;return n};$.prototype._createRequestID=function(){var e;e=m();return e};$.prototype._getServerUrl=function(){var e,t;e=new F(this.sServiceUrl).absoluteTo(document.baseURI);t=new F("/").absoluteTo(e).toString();return t};$.prototype._createMetadataUrl=function(e){if(e.indexOf(this.sServiceUrl)==-1){if(!e.startsWith("/")){e="/"+e}e=this.sServiceUrl+e}var t=Object.assign({},this.mMetadataUrlParams);const a=new URL(e,"https://localhost").searchParams;for(const[e]of a){t[e]=a.get(e)}var s=k._createUrlParamsArray(t);var r=e.split("?");if(r.length>1){e=r[0]}return this._addUrlParams(e,s)};$.prototype._addUrlParams=function(e,t){var a=[];if(this.aUrlParams){a=a.concat(this.aUrlParams)}if(t){a=a.concat(t)}if(a.length>0){e+="?"+a.join("&")}return e};$.prototype._createRequestUrl=function(e,t,a,s){return this._createRequestUrlWithNormalizedPath(this._normalizePath(e,t),a,s)};$.prototype._createRequestUrlWithNormalizedPath=function(e,t,a){var s="";if(!a){s=this.sServiceUrl+e}else{s=e.substr(e.indexOf("/")+1)}return this._addUrlParams(s,t)};$.prototype._importData=function(e,t,a,s,r,n,i,o,d,u){var h=this,f,p,g,_;r=r||"";i=i||"";if(e.results&&Array.isArray(e.results)){f=[];c(e.results,function(e,s){var i=h._getKey(s);i=h._importData(s,t,a,undefined,r.substr(0,r.lastIndexOf("/")),n,i,undefined,undefined,u);if(i){f.push(i)}});return f}else{if(i){r="/"+i;n+=i.substr(i.indexOf("("))}else{i=this._getKey(e)}if(!i){return i}g=this._getEntity(i);_=g;if(!g||g.__metadata&&g.__metadata.invalid){if(!_){_=e}g=e;i=this._addEntity(g)}if(this.aBindableResponseHeaders){var m={};for(var y in a.headers){var v=y.toLowerCase();if(this.aBindableResponseHeaders.indexOf(v)>-1){m[v]=a.headers[y]}}if(!l(m)){if(!e.__metadata){e.__metadata={}}e.__metadata.headers=m}}c(e,function(e,s){if(s&&(s.__metadata&&s.__metadata.uri||s.results)&&!s.__deferred){var o=r+"/"+e;var d=n+"/"+e;p=h._importData(s,t,a,undefined,o,d,undefined,false,"/"+i+"/"+e,u);if(Array.isArray(p)){g[e]={__list:p};if(u){g[e].__list.sideEffects=true;h.aSideEffectCleanUpFunctions.push(function(){delete g[e]})}}else{if(_[e]&&_[e].__ref){if(_[e].__ref!==p){h.mInvalidatedPaths[r.substr(r.lastIndexOf("("))+"/"+e]="/"+p}}g[e]={__ref:p}}}else if(!s||!s.__deferred){if(_[e]&&s===null){h.mInvalidatedPaths[r.substr(r.lastIndexOf("("))+"/"+e]=null}g[e]=s}});if(this.hasContext("/"+i)&&this.getContext("/"+i).isPreliminary()){var b=this.getContext("/"+i);b.setUpdated(true);this.callAfterUpdate(function(){b.setUpdated(false)});b.setPreliminary(false)}if(s&&s.created&&s.key){this._cleanupAfterCreate(s,i)}this._updateChangedEntity(i,g);t[i]=true;r=r||"/"+i;n=n||r;var C=this.resolveFromCache(n);if(C==="/"+i||C&&C.split("/").length>2){this._writePathCache(C,"/"+i,o)}this._writePathCache(r,"/"+i,o);this._writePathCache(n,"/"+i,o,true);if(d){this._writePathCache(d,"/"+i,o)}return i}};$.prototype._writePathCache=function(e,t,a,s){var r,n,i,o,d,u;if(e&&t){if(!this.mPathCache[e]){this.mPathCache[e]={}}if(!a&&e.lastIndexOf("/")===0){t=e}this.mPathCache[e].canonicalPath=t;if(s){d=e.split("/");for(u=3;u<d.length;u+=1){i=d.slice(0,u).join("/");o=this.mPathCache[i];if(o){r=o.canonicalPath+e.slice(i.length);n=this.mPathCache[r];if(n){n.canonicalPath=t}}}}}};$.prototype._removeReferences=function(e){var t=this,a;if(!e){return e}if(e.results){a=[];c(e.results,function(e,s){a.push(t._removeReferences(s))});return a}else{c(e,function(t,a){if(a){if(a["__ref"]||a["__list"]){delete e[t]}}});return e}};$.prototype._restoreReferences=function(e,t){var a=this,s,r,n;function o(e){var s=t[e];if(!s){s=a._getObject("/"+e);i(s,"ODataModel inconsistent: "+e+" not found!");if(s){s=_({},s);t[e]=s;a._restoreReferences(s,t)}}return s}if(!t){t={}}c(e,function(t,a){if(a){if(a.__ref){s=a.__ref;r=o(s);if(r){e[t]=r}delete a.__ref}else if(a.__list){n=[];c(a.__list,function(e,t){r=o(t);if(r){n.push(r)}});delete a.__list;a.results=n}}});return e};$.prototype.removeData=function(){this.oData={}};$.prototype.initialize=function(){var e=this.getBindings();e.forEach(function(e){e.initialize()})};$.prototype.invalidate=function(e){var t;for(var a in this.oData){t=this.oData[a];if(!e||e(a,t)){t.__metadata.invalid=true}}};$.prototype.invalidateEntry=function(e){var t;if(typeof e==="string"){if(e.indexOf("/")===0){t=this._getObject(e)}else{t=this.oData[e]}}else if(e instanceof E){t=this._getObject(e.getPath())}if(t&&t.__metadata){t.__metadata.invalid=true}};$.prototype.invalidateEntityType=function(e){var t;for(var a in this.oData){t=this.oData[a];if(t.__metadata.type===e){t.__metadata.invalid=true}}};$.prototype.refresh=function(e,t,a){if(typeof e==="string"){a=e;e=false;t=false}if(t){this.removeData()}this._refresh(e,a)};$.prototype._refresh=function(e,t,a,s){var r=this.getBindings();this.sRefreshGroupId=t;r.forEach(function(t){t._refresh(e,a,s)});this.sRefreshGroupId=undefined};$.prototype.checkUpdate=function(e,t,a,s){if(t){this.bForceUpdate=this.bForceUpdate||e;Object.assign(this.mChangedEntities4checkUpdate,a);if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(this.bForceUpdate,false,this.mChangedEntities4checkUpdate)}.bind(this),0)}return}e=this.bForceUpdate||e;if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;this.bForceUpdate=undefined;this.mChangedEntities4checkUpdate={}}var r=this.getBindings();r.forEach(function(t){if(!s||this.isMetaModelPath(t.getPath())){t.checkUpdate(e,a)}}.bind(this));this._processAfterUpdate()};$.prototype.checkDataState=function(e){var t=this.getBindings();t.forEach(function(t){if(t.checkDataState){t.checkDataState(e)}})};$.prototype.bindProperty=function(e,t,a){var s=new O(this,e,t,a);return s};$.prototype.bindList=function(e,t,a,s,n){var i=new r(this,e,t,a,s,n);return i};$.prototype.bindTree=function(e,t,a,s,r){var i=new n(this,e,t,a,s,r);return i};$.prototype.createBindingContext=function(e,t,a,s,r){var n,i,o,d,u,h,f,c,p,l=this;if(t!==null&&typeof t==="object"&&!(t instanceof E)){r=s;s=a;a=t;t=undefined}if(typeof t=="function"){r=a;s=t;a=undefined;t=undefined}if(typeof t=="boolean"){r=t;s=undefined;a=undefined;t=undefined}if(typeof a=="function"){r=s;s=a;a=undefined}if(typeof a=="boolean"){r=a;s=undefined;a=undefined}if(typeof s=="boolean"){r=s;s=undefined}if(a){n=a.canonicalRequest}n=this._isCanonicalRequestNeeded(n);p=this.resolve(e,t,n);if(!p&&n){p=this.resolve(e,t)}d=this.resolveDeep(e,t);if(!p){if(s){s(null)}return null}if(r===undefined){r=this._isReloadNeeded(p,a)}if(!r){i=this.resolve(e,t,true);if(i){f=this.getContext(i,d)}else{f=null}if(s){s(f)}return f}function g(a){var r=a?l._getKey(a):null,n=!(e===""||e.indexOf("/")>0),i=null,o,u;f=null;if(r){f=l.getContext("/"+r,d);i={__ref:r}}if(t&&h&&n){o=t.getPath();o=o.substr(1);u=l._getEntity(o);if(u){u[e]=i}}s(f)}function _(a){var r;if(a.statusCode=="404"&&t&&h){var n=t.getPath();n=n.substr(1);r=l._getEntity(n);if(r){r[e]={__ref:null}}}s(null)}if(s){h=!e.startsWith("/");c=[];o=this.createCustomParams(a);if(o){c.push(o)}if(a&&(a.batchGroupId||a.groupId)){u=a.groupId||a.batchGroupId}this.read(e,{canonicalRequest:n,context:t,error:_,groupId:u,success:g,updateAggregatedMessages:true,urlParameters:c})}if(a&&a.createPreliminaryContext){p=this.resolve(e,t,n);if(!p&&n){p=this.resolve(e,t)}f=this.getContext(p,d);return f}return undefined};$.prototype._updateContext=function(e,t,a){e.sPath=t;if(a!==undefined){e.sDeepPath=a}this.mContexts[t]=e};$.prototype._splitEntries=function(e){return e.replace(/\s/g,"").split(",").map(function(e){return e.split("/")})};$.prototype._filterOwnSelect=function(e,t){var a,s;if(!t){return[]}s=t.map(function(e){return e.name});a=e.filter(function(e){return e.length===1}).map(function(e){return e[0]});if(e.length===0||a.indexOf("*")!==-1||a.indexOf("**")!==-1){return s}else{return a.filter(function(e){return s.indexOf(e)!==-1})}};$.prototype._filterOwnExpand=function(e,t){return e.map(function(e){return e[0]}).filter(function(e,t,a){return a.indexOf(e)===t}).filter(function(e){return t.length===0||t.some(function(t){return t.indexOf(e)===0||t.indexOf("**")===0})})};$.prototype._filterSelectByNavProp=function(e,t){return e.filter(function(e){return e[0]===t}).map(function(e){return e.length>1?e.slice(1):["**"]})};$.prototype._filterExpandByNavProp=function(e,t){return e.filter(function(e){return e.length>1&&e[0]===t}).map(function(e){return e.slice(1)})};$.prototype._isReloadNeeded=function(e,t){var a=this,s=this.oMetadata,r,n=[],i=[];if(!this.oMetadata.isLoaded()){return true}var o;if(t){o=t.canonicalRequest}o=this._isCanonicalRequestNeeded(o);if(o){e=this.resolve(e,undefined,o)||e}var d=this._getObject(e);r=this.oMetadata._getEntityTypeByPath(e);if(this._isCreatedEntity(d)){return false}function u(e,t,r,n){var i,o,d,h,f,c,p,l,g,_;if(!e){return false}if(t===null){return false}if(!t){return true}if(t.__metadata&&t.__metadata.invalid){return true}g=a._filterOwnSelect(r,e.property);for(o=0;o<g.length;o++){_=g[o];if(t[_]===undefined){return true}}l=a._filterOwnExpand(n,r);for(o=0;o<l.length;o++){i=l[o];d=t[i];if(d===null){continue}if(d===undefined||d.__deferred){return true}f=s._getEntityTypeByNavProperty(e,i);p=a._filterSelectByNavProp(r,i);c=a._filterExpandByNavProp(n,i);if(d.__ref){h=a._getEntity(d.__ref);if(u(f,h,p,c)){return true}}if(d.__list){for(var m=0;m<d.__list.length;m++){h=a._getEntity(d.__list[m]);if(u(f,h,p,c)){return true}}}}return false}if(t){if(t.select){i=this._splitEntries(t.select)}if(t.expand){n=this._splitEntries(t.expand)}}return u(r,d,i,n)};$.prototype.createCustomParams=function(e){var t=[],a,s={expand:true,select:true};for(var r in e){if(r in s){t.push("$"+r+"="+u(e[r]))}if(r==="custom"){a=e[r];for(r in a){if(r.indexOf("$")===0){o.warning(this+" - Trying to set OData parameter '"+r+"' as custom query option!")}else if(typeof a[r]==="string"){t.push(r+"="+u(a[r]))}else{t.push(r)}}}}return t.join("&")};$.prototype.bindContext=function(e,t,a){var r=new s(this,e,t,a);return r};$.prototype.setDefaultCountMode=function(e){this.sDefaultCountMode=e};$.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode};$.prototype._addEntity=function(e){var t=this._getKey(e);this.oData[t]=e;return t};$.prototype._removeEntity=function(e){e=e&&k._normalizeKey(e);delete this.oData[e];delete this.mChangedEntities[e];delete this.mContexts["/"+e]};$.prototype._getEntity=function(e){var t=this.oData[e];if(!t){e=e&&k._normalizeKey(e);t=this.oData[e]}return t};$.prototype._getKey=function(e){var t,a;if(e instanceof E){t=e.getPath().substr(1)}else if(e&&e.__metadata&&e.__metadata.uri){a=e.__metadata.uri;t=a.substr(a.lastIndexOf("/")+1)}else if(typeof e==="string"){t=e.substr(e.lastIndexOf("/")+1)}if(!this.oData[t]){t=t&&k._normalizeKey(t)}return t};$.prototype.getKey=function(e){return this._getKey(e)};$.prototype.createKey=function(e,t){var a=this.oMetadata._getEntityTypeByPath(e),s=e,r=this,n,o;i(a,'Could not find entity type of collection "'+e+'" in service metadata!');s+="(";if(a.key.propertyRef.length===1){n=a.key.propertyRef[0].name;i(n in t,'Key property "'+n+'" is missing in object!');o=this.oMetadata._getPropertyMetadata(a,n);s+=encodeURIComponent(k.formatValue(t[n],o.type))}else{c(a.key.propertyRef,function(e,d){if(e>0){s+=","}n=d.name;i(n in t,'Key property "'+n+'" is missing in object!');o=r.oMetadata._getPropertyMetadata(a,n);s+=n;s+="=";s+=encodeURIComponent(k.formatValue(t[n],o.type))})}s+=")";return s};$.prototype.getProperty=function(e,t,a){var s=this._getObject(e,t);if(!a){return s}if(!g(s)){return s}s=_({},s);if(a===true){return this._restoreReferences(s)}else{return this._removeReferences(s)}};$.prototype.getObject=function(e,t,a){if(g(t)){a=t;t=undefined}var s=this,r=this.resolve(e,t),n=this._getObject(r),i=this.oMetadata._getEntityTypeByPath(r),d=[],u=[];if(!i||!g(n)||!n.__metadata||!n.__metadata.uri){return n}if(!a||!(a.select||a.expand)){return _({},n)}function h(e,t,a,r){var n,i,d,u,f,c,p,l,g,_,m,y,v,b;if(!t){return undefined}if(!e){return undefined}m=s._filterOwnSelect(a,e.property);v={};for(i=0;i<m.length;i++){b=m[i];if(t[b]!==undefined||t.__metadata.created){v[b]=t[b]}else{o.fatal("No data loaded for select property: "+b+" of entry: "+s.getKey(t));return undefined}}if(t.__metadata){v.__metadata=t.__metadata}g=s._filterOwnExpand(r,a);for(i=0;i<g.length;i++){n=g[i];d=t[n];u=s.oMetadata._getEntityTypeByNavProperty(e,n);p=s._filterSelectByNavProp(a,n);f=s._filterExpandByNavProp(r,n);if(d&&d.__ref){c=s._getObject("/"+d.__ref);l=h(u,c,p,f);if(l!==undefined){v[n]=l}else{o.fatal("No data loaded for expand property: "+n+" of entry: "+s.getKey(l));return undefined}}if(d&&d.__list){y=[];for(var C=0;C<d.__list.length;C++){c=s._getObject("/"+d.__list[C]);l=h(u,c,p,f);if(l!==undefined){y.push(l)}else{o.fatal("No data loaded for expand property: "+n+" of entry: "+s.getKey(l));return undefined}}v[n]=y}}_=s._filterOwnSelect(a,e.navigationProperty);for(var P=0;P<_.length;P++){n=_[P];if(g.indexOf(n)===-1){var q=v.__metadata.uri+"/"+n;v[n]={__deferred:{uri:q}}}}return v}if(a.select){u=this._splitEntries(a.select)}if(a.expand){d=this._splitEntries(a.expand)}n=h(i,n,u,d);return n};$.prototype._getObject=function(e,t,a,s){var r,n,i,o,d,u,h,f,c,p,l,m=s?undefined:null;let y=m;if(this.isLegacySyntax()){y=this.oData}p=this.resolve(e,t,this.bCanonicalRequests);if(!p&&this.bCanonicalRequests){p=this.resolve(e,t)}if(!p){return y}if(e&&e.startsWith("@$ui5.")){return this._getInstanceAnnotationValue(e,t)}if(this._isMetadataPath(p)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(p)){h=this.getMetaModel();i=I.getCodeListTerm(p);if(i){n=h.fetchCodeList(i);if(n.isFulfilled()){return n.getResult()}if(n.isRejected()){n.caught()}return undefined}if(!this.bMetaModelLoaded){return null}l=p.indexOf("/##");o=p.substr(0,l);f=p.substr(l+3);u=h.getMetaContext(o);y=h.getProperty(f,u)}else{y=this.oMetadata._getAnnotation(p)}}else if(I.getCodeListTerm(p)){return undefined}}else{if(p==="/"){return this.oData}var v=p.split("/"),b=0;d=v[1];v.splice(0,2);r=this.mChangedEntities[d];c=this._getEntity(d);y=a?c:r||c;while(y&&v[b]){var C=r&&r.hasOwnProperty(v[b]);r=r&&r[v[b]];c=c&&c[v[b]];y=a||!C?c:r;if(y){if(y.__ref){r=this.mChangedEntities[y.__ref];c=this._getEntity(y.__ref);y=a?c:r||c}else if(y.__list){y=y.__list}else if(y.__deferred){y=undefined}}b++}}if(g(r)){y=a?c:_({},c,r)}return y};$.prototype._getInstanceAnnotationValue=function(e,t){if(e==="@$ui5.context.isInactive"){return t.isInactive()}if(e==="@$ui5.context.isTransient"){return t.isTransient()}throw new Error("Unsupported instance annotation: "+e)};$.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken()}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}}};$.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken};$.prototype.getSecurityToken=function(){var e=this.oSharedServiceData.securityToken;if(!e){this.refreshSecurityToken();e=this.oSharedServiceData.securityToken}return e};$.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken)}else{this.pSecurityToken=new Promise(function(e,t){this.refreshSecurityToken(function(){e(this.oSharedServiceData.securityToken)}.bind(this),function(){t()},true)}.bind(this))}}return this.pSecurityToken};$.prototype.refreshSecurityToken=function(e,t,a){var s,r,n={abort:function(){this.request.abort()}},i=this._createRequestUrlWithNormalizedPath("/"),o=this;function d(t,a){if(a){r=o._getHeader("x-csrf-token",a.headers);o._setSessionContextIdHeader(o._getHeader("sap-contextid",a.headers));if(r){if(o.oSharedServerData){o.oSharedServerData.securityToken=r}o.oSharedServiceData.securityToken=r;o.pSecurityToken=Promise.resolve(r);o.oHeaders["x-csrf-token"]=r}else{o.resetSecurityToken();o.bTokenHandling=false}}if(e){e(t,a)}}function u(e){o.resetSecurityToken();o.bTokenHandling=false;o._handleError(e,s);if(t){t(e)}}function h(e){n.request=f("GET",u)}function f(e,t){s=o._createRequest(i,"",e,o._getHeaders(undefined,true),null,null,!!a);s.headers["x-csrf-token"]="Fetch";return o._request(s,d,t,undefined,undefined,o.getServiceMetadata())}if(this.bDisableHeadRequestForToken){n.request=f("GET",u)}else{n.request=f("HEAD",h)}return n};$.prototype._submitRequest=function(e,t,a){var s=this,r,n,i,o,d;o=new Promise(function(e,t){d=e});function u(e,a){if(t){t(e,a)}s.aSideEffectCleanUpFunctions.forEach(function(e){e()});s.aSideEffectCleanUpFunctions=[];d()}function h(t){if(s.bTokenHandling&&t.response){var r=s._getHeader("x-csrf-token",t.response.headers);if(!e.bTokenReset&&t.response.statusCode=="403"&&r&&r.toLowerCase()==="required"){s.resetSecurityToken();e.bTokenReset=true;p();return}}if(a){a(t)}d()}function f(e){if(s.bTokenHandling&&(e.method!=="GET"||s.bTokenHandlingForGet)){s.pReadyForRequest=s.securityTokenAvailable()}return s.pReadyForRequest}function p(){if(s.bTokenHandling){delete e.headers["x-csrf-token"]}f(e).then(function(t){if(s.bTokenHandling&&(e.method!=="GET"||s.bTokenHandlingForGet)){e.headers["x-csrf-token"]=t}g()},function(){g()})}function l(e,t,a){var r,n=t.eventInfo.requests;if(n){c(n,function(t,a){if(Array.isArray(a)){a.forEach(function(t){c(t.parts,function(a,n){r=s._createEventInfo(t.request,n.fnError);s["fireRequest"+e](r)})})}else if(a.parts){c(a.parts,function(t,n){r=s._createEventInfo(a.request,n.fnError);s["fireRequest"+e](r)})}else{r=s._createEventInfo(a.request,a.fnError);s["fireRequest"+e](r)}});if(t.eventInfo.batch){r=s._createEventInfo(t,a,n);s["fireBatchRequest"+e](r)}}}function g(){if(s.sSessionContextId){e.headers["sap-contextid"]=s.sSessionContextId}n=s._request(e,u,h,r,undefined,s.getServiceMetadata());if(e.eventInfo){l("Sent",e,null);delete e.eventInfo}if(i&&n){n.abort()}}r=s._getODataHandler(e.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){p()});this.pSequentialRequestCompleted=o}else{p()}return{abort:function(){if(n){n.abort()}i=true}}};$.prototype._setSessionContextIdHeader=function(e){if(e){this.sSessionContextId=e}};$.prototype._submitSingleRequest=function(e){var t=this,a,s={},r={},n={};function i(a,i){if(a===undefined&&i.statusCode===200){o({message:"Response did not contain a valid OData result",response:i});return}function d(a,i){for(var o=0;o<e.parts.length;o++){if(e.parts[o].request._aborted){t._processAborted(e.parts[o].request,i)}else if(e.parts[o].fnSuccess){e.parts[o].fnSuccess(a,i)}}if(e.request.requestUri.indexOf("$count")===-1){t.checkUpdate(false,false,r);if(e.bRefreshAfterChange){t._refresh(false,undefined,s,n)}}}t._processSuccess(e.request,i,d,r,s,n);t._invalidatePathCache();t._setSessionContextIdHeader(t._getHeader("sap-contextid",i.headers))}function o(a){var s;if(a.message=="Request aborted"){for(s=0;s<e.parts.length;s++){t._processAborted(e.parts[s].request,a)}}else{for(s=0;s<e.parts.length;s++){t._processError(e.parts[s].request,a,e.parts[s].fnError)}}t._processAfterUpdate()}e.request.eventInfo={requests:e.parts,batch:false};a=this._submitRequest(e.request,i,o);return a};$.prototype._submitBatchRequest=function(e,t,a,s){var r=this,n={},i={},o={},d={};function u(e,t,a){var s,u,h;for(h=0;h<e.parts.length;h++){var f,c;if(a||e.parts[h].request._aborted){r._processAborted(e.parts[h].request,t)}else if(t.message){r._processError(e.parts[h].request,t,e.parts[h].fnError)}else{if(e.request.contentID){s=e.request.contentID;if(e.request.created||e.request.functionMetadata){u=r._getKey(t.data);i[s]={key:u,functionImport:!!e.request.functionMetadata,deepPath:e.request.deepPath.replace("('"+s+"')",u.slice(u.indexOf("(")))}}else{u=i[s].key;if(i[s].functionImport){f=e.request.deepPath;c=e.request.requestUri}e.request.requestUri=e.request.requestUri.replace("$"+s,u);e.request.deepPath=i[s].deepPath}}r._processSuccess(e.parts[h].request,t,e.parts[h].fnSuccess,o,n,d,false,undefined,i);if(c){e.request.deepPath=f;e.request.requestUri=c}}}}function h(s,i){if(s===undefined&&i.statusCode===200){f({message:"Response did not contain a valid OData batch result",response:i});return}var h,c,p,l=s.__batchResponses;if(l){var g,_;for(g=0;g<l.length;g++){h=l[g];if(Array.isArray(t[g])){if(h.message){for(_=0;_<t[g].length;_++){h.$reported=false;c=t[g][_];u(c,h);c.response=h}}else{p=h.__changeResponses;for(_=0;_<p.length;_++){var m=p[_];c=t[g][_];u(c,m);c.response=m}}}else{c=t[g];u(c,h);c.response=h}}r._invalidatePathCache();r.checkUpdate(false,false,o)}r._processSuccess(e,i,a,o,n,d,true,t);r._setSessionContextIdHeader(r._getHeader("sap-contextid",i.headers))}function f(a){var n=a.message=="Request aborted";a.$reported=true;c(t,function(e,t){if(Array.isArray(t)){t.forEach(function(e){u(e,a,n)})}else{u(t,a,n)}});r._processAfterUpdate();if(n){r._processAborted(e,a,true)}else{a.$reported=false;r._processError(e,a,s,true,t)}}e.eventInfo={requests:t,batch:true};var p=this._submitRequest(e,h,f);function l(e){var t;for(var a=0;a<e.parts.length;a++){t=e.parts[a].fnError;if(!e.parts[a].request._aborted&&t){t($._createAbortedError())}}}var g={abort:function(e){c(t,function(e,t){if(Array.isArray(t)){t.forEach(function(e){l(e)})}else{l(t)}});if(s&&!e){s($._createAbortedError())}p.abort()}};return g};$.prototype._invalidatePathCache=function(){var e=this,t;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(a){for(var s in e.mInvalidatedPaths){t=a.indexOf(s);if(t>-1){if(t+s.length!==a.length){var r=a.substr(t+s.length);e.mPathCache[a].canonicalPath=e.mInvalidatedPaths[s]===null?null:e.mInvalidatedPaths[s]+r}else{e.mPathCache[a].canonicalPath=e.mInvalidatedPaths[s]}}}})}this.mInvalidatedPaths={}};$.prototype._createBatchRequest=function(e){var t,a,s={},r={},n=true;r.__batchRequests=e;for(var i in e){if(e[i]&&e[i].__changeRequests||e[i]&&e[i].headers&&!e[i].headers["sap-cancel-on-close"]){n=false;break}}t=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){t+="?"+this.aUrlParams.join("&")}p(s,this.mCustomHeaders,this.oHeaders);s["Accept"]="multipart/mixed";delete s["Content-Type"];s["sap-cancel-on-close"]=n;a={headers:s,requestUri:t,method:"POST",data:r,user:this.sUser,password:this.sPassword,async:true};a.withCredentials=this.bWithCredentials;return a};$.prototype.abortInternalRequest=function(e,t){var a=this.mRequests;var s,r;if(t){s=t.requestKey;r=t.path}if(e in this.mDeferredGroups){a=this.mDeferredRequests}var n=function(e){for(var t=0;t<e.parts.length;t++){e.parts[t].requestHandle.abort()}};var i=a[e];if(i){if(s in i.map){n(i.map[s])}else if(r){c(i.map,function(e,t){if(e.indexOf(r)>=0){n(t)}})}else if(e&&!t){c(i.map,function(e,t){n(t)})}}};$.prototype._pushToRequestQueue=function(e,t,a,s,r,n,i,o){var d,u=e[t],h=s.key?s.key:s.method+":"+s.requestUri;if(this.bWarmup){return}if(!u){u={};u.map={};u.requests=[];e[t]=u}if(h in u.map&&(s.key||s.method==="GET")){d=u.map[h];var f=d.request;s.deepPath=f.deepPath;if(d.bRefreshAfterChange===undefined){d.bRefreshAfterChange=o}if(!s.key){d.parts.push({request:s,fnSuccess:r,fnError:n,requestHandle:i})}if(s.method==="GET"){delete f.data}else{f.method=s.method;f.headers=s.headers;f.data=s.data;f.sideEffects=s.sideEffects;if(s.method==="PUT"){delete f.headers["x-http-method"]}if(f._aborted){delete f._aborted}}if(f.functionMetadata){f.requestUri=s.requestUri;f.functionTarget=s.functionTarget}}else{d={request:s,bRefreshAfterChange:o,parts:[{request:s,fnSuccess:r,fnError:n,requestHandle:i}]};if(s.method==="GET"){u.requests.push(d)}else{if(!u.changes){u.changes={}}var c=u.changes[a];if(!c){c=[];u.changes[a]=c}d.changeSetId=a;c.push(d)}u.map[h]=d}};$.prototype._collectChangedEntities=function(e,t,a){var s=this;if(e.changes){c(e.changes,function(e,r){for(var n=0;n<r.length;n++){if(r[n].bRefreshAfterChange){var i=r[n].request,o="/"+i.requestUri.split("?")[0],d,u;if(i.method==="POST"||i.method==="DELETE"){var h=s.oMetadata._getEntityTypeByPath(o);if(h){a[h.entityType]=true}}else{d=s._getObject(o);if(d){u=s._getKey(d)}else if(o.lastIndexOf("/")===0){u=s._getKey(o)}if(u){t[u]=true}}}}})}};$.prototype._processRequestQueue=function(e,t,a,s,r){var n=this,i,o=[];function d(e,t){for(var a=0;a<e.parts.length;a++){var s=e.parts[a];if(s.request._aborted){n._processAborted(e.request,null);e.parts.splice(a,1);a--}else if(t){s.request._handle=t;t.iRelevantRequests++}}}function u(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort(true);if(a){a({},undefined)}}}}}if(this.bUseBatch){c(e,function(e,a){if(e===t||!t){var s={},r={};n._collectChangedEntities(a,s,r);if(Object.keys(s).length||Object.keys(r).length){n.bIncludeInCurrentBatch=true;n._refresh(false,e,s,r);n.bIncludeInCurrentBatch=false}}});c(e,function(h,f){if(h===t||!t){var p=[],l=[],g,_;var m=u();if(f.changes){c(f.changes,function(t,a){var s,o,u;g={__changeRequests:[]};_=[];for(o=0;o<a.length;o++){s=a[o].request;M.extend(s.headers,r);i="/"+n.getKey(s.data);n.increaseLaundering(i,s.data);d(a[o],m);if(a[o].parts.length>0){n.removeInternalMetadata(s.data);g.__changeRequests.push(s);if(s.expandRequest){u=a[o].parts[0];n._pushToRequestQueue(e,h,undefined,s.expandRequest,u.fnSuccess,u.fnError,u.requestHandle,false)}_.push(a[o])}}if(g.__changeRequests&&g.__changeRequests.length>0){p.push(g);l.push(_)}})}if(f.requests){var y=f.requests;for(var v=0;v<y.length;v++){d(y[v],m);if(y[v].parts.length>0){p.push(y[v].request);l.push(y[v])}}}if(p.length>0){var b=n._createBatchRequest(p);m.oRequestHandle=n._submitBatchRequest(b,l,a,s);o.push(m.oRequestHandle)}delete e[h]}})}else{c(e,function(a,s){if(a===t||!t){if(s.changes){c(s.changes,function(e,t){for(var a=0;a<t.length;a++){var s=u();i="/"+n.getKey(t[a].request.data);n.increaseLaundering(i,t[a].request.data);d(t[a],s);if(t[a].parts.length>0){n.removeInternalMetadata(t[a].request.data);s.oRequestHandle=n._submitSingleRequest(t[a]);o.push(s.oRequestHandle)}}})}if(s.requests){var r=s.requests;for(var h=0;h<r.length;h++){var f=u();d(r[h],f);if(r[h].parts.length>0){f.oRequestHandle=n._submitSingleRequest(r[h]);o.push(f.oRequestHandle)}}}delete e[a]}})}this.checkDataState(this.mLaunderingState);return o.length==1?o[0]:o};$.prototype._processRequestQueueAsync=function(e){var t=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){t._processRequestQueue(e);t.pCallAsync=undefined})})}};$.prototype._processSuccess=function(e,t,a,s,r,n,i,d,u){var h,f,l,g,m,y,v,b,C,P,q,M,R,E={},S={},T=t.data,x=this;if(!i){f=!["204","205"].includes(String(t.statusCode));R=e.requestUri;q=R.replace(this.sServiceUrl,"");if(!q.startsWith("/")){q="/"+q}C=this._normalizePath(q);m=this.oMetadata._getEntityTypeByPath(C);b=m&&m.isFunction;q=this._normalizePath(q,undefined,!b);this.decreaseLaundering(q,e.data);this._decreaseDeferredRequestCount(e);if(e.functionMetadata){if(t.headers&&t.headers.location){y=t.headers.location;M=y.lastIndexOf(this.sServiceUrl);if(M>-1){h=k._normalizeKey(y.slice(M+this.sServiceUrl.length));if(e.functionTarget===h){l=this.getDeepPathForCanonicalPath(h);if(l){e.deepPath=l}}e.functionTarget=h}}if(e.adjustDeepPath){e.deepPath=e.adjustDeepPath({deepPath:l||e.functionTarget,response:_({},t)})}else if(!l){if(!y){l=this.getDeepPathForCanonicalPath(e.functionTarget)}e.deepPath=l||e.functionTarget}if(u&&e.contentID){u[e.contentID].deepPath=e.deepPath}}if(f&&T===undefined&&t){this._parseResponse(t,e);o.fatal(this+" - No data was retrieved by service: '"+t.requestUri+"'");x.fireRequestCompleted({url:t.requestUri,type:"GET",async:t.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false}if(T&&!T.__metadata&&T.results&&!Array.isArray(T.results)){T=T.results}if(!t._imported&&T&&(Array.isArray(T)||typeof T=="object")){v=_({},T);if(e.key||e.created){x._importData(v,S,t,e,undefined,undefined,undefined,b,undefined,e.sideEffects)}else{x._importData(v,S,t,e,q,e.deepPath,undefined,b,undefined,e.sideEffects)}t._imported=true}g=this._getEntity(e.key);if(g&&g.__metadata.created&&g.__metadata.created.functionImport){var A=[];var U=g["$result"];if(U&&U.__list){c(S,function(e){A.push(e)});U.__list=A}else if(U&&U.__ref){c(S,function(e){U.__ref=e})}}if(!f){P=q.split("/");if(P[1]){E[P[1]]=e;this._updateChangedEntity(P[1],e.data)}if(e.method==="DELETE"&&P[2]!=="$links"){this._removeEntity(P[1])}}if(f&&e.method==="POST"||e.functionMetadata){if(m){n[m.entityType]=true}if(e.key){if(e.created){this._removeEntity(e.key)}else{delete this.mChangedEntities[e.key]}}}if(!t.$reported){this._parseResponse(t,e,S,E);t.$reported=true}p(s,S);p(r,E);this._updateETag(e,t)}if(a){a(T,t)}var I=this._createEventInfo(e,t,d);if(i){this.fireBatchRequestCompleted(I)}else{this.fireRequestCompleted(I)}return true};$.prototype._cleanupAfterCreate=function(e,t){var a,s,r,n=this.getContext("/"+e.key),i=e.deepPath,o=this._getEntity(t);if(n.isTransient()&&i.endsWith(")")){e.deepPath=i.slice(0,i.lastIndexOf("("))+t.slice(t.indexOf("("))}this._updateContext(n,"/"+t,e.deepPath);n.setUpdated(true);this.callAfterUpdate(function(){n.setUpdated(false)});delete o.__metadata.created;a=this.mChangedEntities[e.key];if(a){s=this.oMetadata._getNavigationPropertyNames(this.oMetadata._getEntityTypeByPath(t));a=M.merge({},a);a.__metadata=M.merge({},o.__metadata);a.__metadata.deepPath=e.deepPath;for(r in e.data){if(M.deepEqual(e.data[r],a[r])||s.includes(r)){delete a[r]}}this.mChangedEntities[t]=a;this.abortInternalRequest(this._resolveGroup(e.key).groupId,{requestKey:e.key})}};$.prototype._processError=function(e,t,a,s,r){var n,i;if(e.functionMetadata){e.deepPath=e.functionTarget}n=this._handleError(t,e);if(!s){i="/"+this.getKey(e.data);this.decreaseLaundering(i,e.data);this._decreaseDeferredRequestCount(e)}if(a){a(n)}var o=this._createEventInfo(e,n,r);if(s){this.fireBatchRequestCompleted(o);this.fireBatchRequestFailed(o)}else{this.fireRequestCompleted(o);this.fireRequestFailed(o)}};$.prototype._processAborted=function(e,t,a){var s,r;if(!a){r="/"+this.getKey(e.data);this.decreaseLaundering(r,e.data);this._decreaseDeferredRequestCount(e)}if(t){s=this._createEventInfo(e,$._createAbortedError());s.success=false;if(a){this.fireBatchRequestCompleted(s)}else{this.fireRequestCompleted(s)}}};$.prototype._processAfterUpdate=function(){var e=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var t=0;t<e.length;t++){e[t]()}};$.prototype._processChange=function(e,t,a,s){var r,n,i,o,d,u,f,p,l,g,m,y,v,b,C,P="/"+e,q=this;d=this.oMetadata._getEntityTypeByPath(e);if(!s){s=this.sDefaultUpdateMethod}m=_({},this._getObject(P),t);o=m.__metadata.deepPath;i=m.__metadata.created;if(i){g=i.method?i.method:"POST";e=i.key;f=i.expandRequest;r=i.contentID;p=i.functionImport;if(p){i.urlParameters=this._createFunctionImportParameters(i.key,g,m);m=undefined}else{delete m.__metadata["uri"]}}else if(s==="MERGE"){g="MERGE";v=this._getEntity(e)}else{g="PUT"}if(m&&m.__metadata){for(var M in m.__metadata){if(M!=="type"&&M!=="uri"&&M!=="etag"&&M!=="content_type"&&M!=="media_src"){delete m.__metadata[M]}}}if(m&&d){var R=this.oMetadata._getNavigationPropertyNames(d);R.forEach(function(e){delete m[e]})}if(g==="MERGE"&&d&&v){c(m,function(t,a){if(t!=="__metadata"){if(h(v[t],a)&&!q.isLaundering("/"+e+"/"+t)){delete m[t]}}});var E="/"+e,S;c(m,function(e,t){if(e!=="__metadata"){S=q.getProperty(E+"/"+e+"/#@sap:unit");if(S){if(m[S]===undefined){m[S]=v[S]}}}});if(v.__metadata.etag){m.__metadata.etag=v.__metadata.etag}}m=this._removeReferences(m);C=i&&i.urlParameters?k._createUrlParamsArray(i.urlParameters):undefined;l=i?this._getHeaders(i.headers):this._getHeaders();if(!p&&this._isTransitionMessagesOnly(a)){l["sap-messages"]="transientOnly"}u=i&&i.eTag?i.eTag:this.getETag(m);b=this._createRequestUrl("/"+e,null,C,this.bUseBatch);n=this.getContext(P);y=this._createRequest(b,o,g,l,m,u,undefined,true,n.hasSubContexts());if(i){if(f){y.expandRequest=f;y.contentID=r}if(p){y.functionTarget=this.oMetadata._getCanonicalPathOfFunctionImport(i.functionMetadata,i.urlParameters);y.functionMetadata=i.functionMetadata}else{y.created=true;this._addSubEntitiesToPayload(n,m)}}if(this.bUseBatch){y.requestUri=y.requestUri.replace(this.sServiceUrl+"/","")}return y};$.prototype._resolveGroup=function(e){var t,a,s,r,n,i,o=e.startsWith("/")?e:"/"+e;r=this._getObject(o);s=r&&r.__metadata&&r.__metadata.created;if(s){return{groupId:s.groupId,changeSetId:s.changeSetId}}n=this.oMetadata._getEntityTypeByPath(o);if(this.mChangeGroups[n.name]){t=this.mChangeGroups[n.name];i=t.groupId;a=t.single?m():t.changeSetId}else if(this.mChangeGroups["*"]){t=this.mChangeGroups["*"];i=t.groupId;a=t.single?m():t.changeSetId}return{groupId:i,changeSetId:a}};$.prototype._updateETag=function(e,t){var a,s,r;a=e.requestUri.replace(this.sServiceUrl+"/","");if(!a.startsWith("/")){a="/"+a}s=this._getObject(a.split("?")[0],undefined,true);r=this._getHeader("etag",t.headers);if(s&&s.__metadata&&r){s.__metadata.etag=r}};$.prototype._handleError=function(e,t,a){var s,r={message:e.message};if(e.response){if(!e.$reported){this._parseResponse(e.response,t);if(this.bTokenHandling){s=this._getHeader("x-csrf-token",e.response.headers);if(e.response.statusCode=="403"&&s&&s.toLowerCase()==="required"){this.resetSecurityToken()}}}r.statusCode=e.response.statusCode;r.statusText=e.response.statusText;r.headers=e.response.headers;r.responseText=e.response.body}else if(!e.$reported){o.error("The following problem occurred: "+e.message,e.stack,a||G)}e.$reported=true;return r};$.prototype.getReporter=function(e){var t=this;return function(a){t._handleError(a,undefined,e)}};$.prototype.getData=function(e,t,a){return this.getProperty(e,t,a)};$.prototype._getODataHandler=function(e){if(e.indexOf("$batch")>-1){return L.batchHandler}else if(e.indexOf("$count")>-1){return undefined}else if(this.bJSON){return L.jsonHandler}else{return L.atomHandler}};$.prototype.getETag=function(e,t,a){if(typeof e=="object"){a=e;e=""}return this._getETag(e,t,a)};$.prototype._getETag=function(e,t,a){if(!a||!a.__metadata){a=this._getObject(e,t)}if(a&&a.__metadata){return a.__metadata.etag}return null};$.prototype.forceEntityUpdate=function(e){var t=this.mChangedEntities[e];if(t&&t.__metadata){t.__metadata.etag="*"}else{o.error(this+" - Entity with key "+e+" does not exist or has no change")}};$.prototype._createRequest=function(e,t,a,s,r,n,i,d,u){var h;i=i!==false;if(n&&a!=="GET"){s["If-Match"]=n}if(!s["Content-Type"]&&a!=="DELETE"&&a!=="GET"){if(this.bJSON){s["Content-Type"]="application/json"}else{s["Content-Type"]="application/atom+xml"}}if(e.indexOf("$count")>-1){s["Accept"]="text/plain, */*;q=0.5"}if(a==="MERGE"&&!this.bUseBatch){s["x-http-method"]="MERGE";a="POST"}if(this.sMessageScope===A.BusinessObject&&s["sap-messages"]!=="transientOnly"){if(this.bIsMessageScopeSupported){s["sap-message-scope"]=this.sMessageScope}else{o.error("Message scope 'sap.ui.model.odata.MessageScope.BusinessObject' is not"+" supported by the service: "+this.sServiceUrl,undefined,G)}}d=d&&this.sMessageScope===A.BusinessObject&&this.bIsMessageScopeSupported;if(this.bUseBatch&&a!=="GET"&&a!=="HEAD"&&!s["Content-ID"]){s["Content-ID"]=m()}h={async:i,deepPath:t,headers:s,method:a,password:this.sPassword,requestUri:e,updateAggregatedMessages:d,user:this.sUser};if(u){h.sideEffects=true}if(r){h.data=r}if(this.bWithCredentials){h.withCredentials=this.bWithCredentials}h.requestID=this._createRequestID();return h};$.prototype._processRequest=function(e,t,a){var s,r,n=false,i=this;if(this.bWarmup){return{abort:function(){}}}if(a){this.iPendingDeferredRequests+=1}r={abort:function(){if(a&&!n){i.iPendingDeferredRequests-=1}if(!n&&t){t($._createAbortedError())}if(s){s._aborted=true;if(s._handle){s._handle.abort()}}n=true}};this.oMetadata.loaded().then(function(){s=e(r);if(s){s.deferred=!!a}i._processRequestQueueAsync(i.mRequests);if(n){r.abort()}});return r};$.prototype.update=function(e,t,a){var s,r,n,i,o,d,u,h,f,c,p,l,g,_,m,y=this,v,b,C;if(a){h=a.groupId||a.batchGroupId;f=a.changeSetId;o=a.context;s=a.success;r=a.error;d=a.eTag;p=a.headers;c=a.urlParameters;_=a.refreshAfterChange;C=a.canonicalRequest;if(a.merge!==undefined){l=a.merge?"MERGE":"PUT"}}C=this._isCanonicalRequestNeeded(C);m=h in y.mDeferredGroups;_=this._getRefreshAfterChange(_,h);u=k._createUrlParamsArray(c);p=this._getHeaders(p);l=l?l:this.sDefaultUpdateMethod;d=d||this._getETag(e,o,t);v=this._normalizePath(e,o,C);b=this.resolveDeep(e,o);return this._processRequest(function(e){i=y._createRequestUrlWithNormalizedPath(v,u,y.bUseBatch);n=y._createRequest(i,b,l,p,t,d);g=y.mRequests;if(m){g=y.mDeferredRequests}y._pushToRequestQueue(g,h,f,n,s,r,e,_);return n},r,m)};$.prototype.create=function(e,t,a){var s,r,n,i,o,d,u,h,f,c,p,l,g,_,m,y=this,v,b,C;if(a){i=a.context;u=a.urlParameters;o=a.success;d=a.error;p=a.groupId||a.batchGroupId;g=a.changeSetId;f=a.headers;_=a.refreshAfterChange;C=a.canonicalRequest}C=this._isCanonicalRequestNeeded(C);_=this._getRefreshAfterChange(_,p);c=k._createUrlParamsArray(u);f=this._getHeaders(f);l="POST";m=p in y.mDeferredGroups;v=y._normalizePath(e,i,C);b=this.resolveDeep(e,i);return this._processRequest(function(e){r=y._createRequestUrlWithNormalizedPath(v,c,y.bUseBatch);s=y._createRequest(r,b,l,f,t);s.created=true;n=y.oMetadata._getEntityTypeByPath(v);s.entityTypes={};if(n){s.entityTypes[n.entityType]=true}h=y.mRequests;if(m){h=y.mDeferredRequests}y._pushToRequestQueue(h,p,g,s,o,d,e,_);return s},d,m)};$.prototype.remove=function(e,t){var a,s,r,n,i,o,d,u,h,f,c,p,l,g,_,m,y,v,b,C=this.bCanonicalRequests,P=this;if(t){u=t.groupId||t.batchGroupId;a=t.changeSetId;s=t.context;m=t.success;o=t.error;d=t.eTag;h=t.headers;b=t.urlParameters;l=t.refreshAfterChange;C=t.canonicalRequest}C=this._isCanonicalRequestNeeded(C);l=this._getRefreshAfterChange(l,u);v=k._createUrlParamsArray(b);h=this._getHeaders(h);c="DELETE";d=d||this._getETag(e,s);i=u in P.mDeferredGroups;p=this._normalizePath(e,s,C);n=this.resolveDeep(e,s);function q(e,t){P._removeEntity(f);if(r&&r.isTransient()===false){P.oCreatedContextsCache.findAndRemoveContext(r)}if(m){m(e,t)}}return this._processRequest(function(e){y=P._createRequestUrlWithNormalizedPath(p,v,P.bUseBatch);f=y.substr(y.lastIndexOf("/")+1);f=f.split("?")[0];r=P.mContexts["/"+f];g=P._createRequest(y,n,c,h,undefined,d,undefined,true);_=P.mRequests;if(i){_=P.mDeferredRequests}P._pushToRequestQueue(_,u,a,g,q,o,e,l);return g},o,i)};$.prototype.callFunction=function(e,t){var a,s,r,n,i,d,u,h,f,c,p,l,g,_,y=this;if(!e.startsWith("/")){o.fatal("callFunction: sFunctionName has to be absolute, but the given '"+e+"' is not absolute",this,G);return undefined}t=t||{};a=t.changeSetId;r=t.error;n=t.eTag;i=t.expand;d=t.groupId||t.batchGroupId;u=t.headers;h=t.method||"GET";f=t.refreshAfterChange;g=t.success;_=Object.assign({},t.urlParameters);if(i){if(!this.bUseBatch){throw new Error("Use 'expand' parameter only with 'useBatch' set to 'true'")}if(h!=="POST"){throw new Error("Use 'expand' parameter only with HTTP method 'POST'")}}f=this._getRefreshAfterChange(f,d);s=new Promise(function(e,t){l=e;c=t});p=this._processRequest(function(s){var p,v,b,C,P,q,M,R,E,S,T,x={},A=r,U=false,I=g;function D(){P=undefined;C=undefined;U=false}b=y.oMetadata._getFunctionImportMetadata(e,h);if(!b){o.error("Function '"+e+"' not found in the metadata",y,G);c();return undefined}if(b.entitySet||b.entitySetPath){x.$result={__list:[]};if(b.returnType&&!b.returnType.startsWith("Collection")){x.$result={__ref:{}}}}if(i&&(!x.$result||!x.$result.__ref)){c(new Error("Use 'expand' parameter only for functions returning a single"+" entity"));return undefined}if(b.parameter!=null){b.parameter.forEach(function(t){if(_[t.name]!==undefined){x[t.name]=_[t.name];_[t.name]=k.formatValue(_[t.name],t.type)}else{x[t.name]=undefined;o.warning("No value given for parameter '"+t.name+"' of function import '"+e+"'",y,G)}})}E=m();if(i){u=Object.assign({},u,{"Content-ID":E,"sap-messages":"transientOnly"});g=function(e,t){if(!P){P=e;C=t;return}if(I){e=Object.assign({},P,e);I(e,C)}D()};r=function(t){if(P){C.expandAfterFunctionCallFailed=true;t.expandAfterFunctionCallFailed=true;o.error("Function '"+e+"' was called successfully, but"+" expansion of navigation properties ("+i+") failed",t,G);if(I){I(P,C)}D();return}if(!U){U=true;if(A){A(t)}}else{t.expandAfterFunctionCallFailed=true;D()}}}x.__metadata={uri:y.sServiceUrl+e+"('"+E+"')",created:{changeSetId:a,error:r,eTag:n,functionImport:true,groupId:d,headers:Object.assign({},u),key:e.substring(1),method:h,success:g},deepPath:e};q=y._addEntity(x);p=y.getContext("/"+q);y._writePathCache("/"+q,"/"+q);l(p);T=k._createUrlParamsArray(_);S=y._createRequestUrlWithNormalizedPath(e,T,y.bUseBatch);M=y._createRequest(S,e,h,y._getHeaders(u),undefined,n,undefined,true);M.adjustDeepPath=t.adjustDeepPath;M.functionMetadata=b;x.__metadata.created.functionMetadata=b;M.functionTarget=y.oMetadata._getCanonicalPathOfFunctionImport(b,_);M.key=q;if(i){v=y._createRequest("$"+E+"?"+k._encodeURLParameters({$expand:i,$select:i}),"/$"+E,"GET",y._getHeaders(undefined,true),undefined,undefined,undefined,true);v.contentID=E;M.expandRequest=v;M.contentID=E;x.__metadata.created.expandRequest=v;x.__metadata.created.contentID=v.contentID}R=y.mRequests;if(d in y.mDeferredGroups){R=y.mDeferredRequests}y._pushToRequestQueue(R,d,a,M,g,r,s,f);return M},r);p.contextCreated=function(){return s};return p};$.prototype._createFunctionImportParameters=function(e,t,a){var s=f({},a);delete s.__metadata;delete s["$result"];var r=this.oMetadata._getFunctionImportMetadata(e,t);i(r,this+": Function "+e+" not found in the metadata !");if(!r){return undefined}if(r.parameter!=null){c(r.parameter,function(e,t){if(s&&s[t.name]!==undefined){s[t.name]=k.formatValue(s[t.name],t.type)}})}return s};$.prototype._getResourcePath=function(e,t,a,s){var r,n,i,o;if(!e){return this.resolve(a,s)}i=this.oMetadata._splitByLastNavigationProperty(t);n=i.pathBeforeLastNavigationProperty;r=i.lastNavigationProperty;if(r.includes("(")&&i.addressable){o=this.resolve(n+r,undefined,true);if(o){return o+i.pathAfterLastNavigationProperty}}o=this.resolve(n,undefined,true)||n;return o+r+i.pathAfterLastNavigationProperty};$.prototype.read=function(e,t){return this._read(e,t)};$.prototype._read=function(e,t,a){var s,r,n,i,o,d,u,h,f,c,p,l,g,_=this;if(t){s=t.canonicalRequest;r=t.context;n=t.error;i=t.filters;o=t.groupId||t.batchGroupId;d=t.headers;f=t.sorters;c=t.success;p=t.updateAggregatedMessages;g=t.urlParameters}s=this._isCanonicalRequestNeeded(s);if(e&&e.indexOf("?")!==-1){e=e.slice(0,e.indexOf("?"))}if(this.sRefreshGroupId){o=this.sRefreshGroupId}l=k._createUrlParamsArray(g);d=this._getHeaders(d,true);u="GET";var m={abort:function(){if(h){h._aborted=true}}};function y(t){var g,m,y,v,b,C,P=_.resolveDeep(e,r),q=_._getResourcePath(s,P,e,r);b=k.createSortParams(f);if(b){l.push(b)}g=_.oMetadata._getEntityTypeByPath(q);m=S.groupFilters(i);y=k.createFilterParams(m,_.oMetadata,g);if(y){l.push(y)}C=_._createRequestUrlWithNormalizedPath(q,l,_.bUseBatch);h=_._createRequest(C,P,u,d,null,undefined,undefined,p,a);v=_.mRequests;if(o in _.mDeferredGroups){v=_.mDeferredRequests}_._pushToRequestQueue(v,o,null,h,c,n,t,false);return h}if(this.bUseBatch&&this.bIncludeInCurrentBatch){h=y(m);return m}else{return this._processRequest(y,n)}};$.prototype.requestSideEffects=function(e,t){var a,s=this;t=t||{};for(a in t){if(!W.includes(a)){throw new Error("Parameter '"+a+"' is not supported")}}return new Promise(function(a,r){var n=new Set,i=[],o=t.urlParameters&&t.urlParameters["$expand"];s._read("",{context:e,error:r,groupId:t.groupId,success:function(){a(i)},updateAggregatedMessages:true,urlParameters:t.urlParameters},true);if(o){o.split(",").forEach(function(t){var a=s.oMetadata._getEntityTypeByPath(s.resolve(t,e));n.add(a)});s.getBindings().forEach(function(e){if(e.isA("sap.ui.model.odata.v2.ODataListBinding")){if(e._refreshForSideEffects(n,t.groupId)){i.push(e)}}})}})};$.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata()}return undefined};$.prototype.metadataLoaded=function(e){var t=this.oMetadata.loaded(e);if(this.bLoadAnnotationsJoined){if(e){return Promise.all([t,this.pAnnotationsLoaded])}var a=function(){return t};return this.pAnnotationsLoaded.then(a,a)}else{return t}};$.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded};$.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed()};$.prototype.getServiceAnnotations=function(){var e=this.oAnnotations.getData();return l(e)?null:e};$.prototype.onAnnotationsFailed=function(e){this.fireAnnotationsFailed(e.getParameters())};$.prototype.onAnnotationsLoaded=function(e){this.fireAnnotationsLoaded(e.getParameters())};$.prototype.addAnnotationUrl=function(e){var t=[].concat(e),a=[],s=[],r=[],n=this;t.forEach(function(e){var t=e.indexOf("$metadata");if(t>=0){e=n._createMetadataUrl(e);a.push(e)}else{s.push(e)}});return this.oMetadata._addUrl(a).then(function(e){return Promise.all(e.map(function(e){r=r.concat(e.entitySets);return n.oAnnotations.addSource({type:"xml",data:e["metadataString"]})}))}).then(function(){return n.oAnnotations.addSource(s)}).then(function(e){return{annotations:n.oAnnotations.getData(),entitySets:r}})};$.prototype.addAnnotationXML=function(e,t){return this.oAnnotations.addSource({type:"xml",data:e})};$.prototype.submitChanges=function(e){return this.submitChangesWithChangeHeaders(e&&{batchGroupId:e.batchGroupId,error:e.error,groupId:e.groupId,merge:e.merge,success:e.success})};$.prototype.submitChangesWithChangeHeaders=function(e){var t,a,s,r,n,i,d,u,h=false,f=this.bRefreshAfterChange,p=this;e=e||{};s=e.groupId||e.batchGroupId;u=e.success;a=e.error;if(e.merge!==undefined){r=e.merge?"MERGE":"PUT"}n=Object.keys(e.changeHeaders||{}).find(function(e){return p._isHeaderPrivate(e)});if(n){throw new Error("Must not use private header: "+n)}this.getBindings().forEach(function(e){if(e._submitChanges){var t=u||function(){},a={groupId:s};e._submitChanges(a);if(a.success){u=function(){t.apply(null,arguments);a.success.apply(null,arguments)}}}});if(s&&!this.mDeferredGroups[s]){o.fatal(this+' submitChanges: "'+s+'" is not a deferred group!')}t=_({},p.mChangedEntities);this.oMetadata.loaded().then(function(){var n,o,l,g,_,m;c(t,function(e,t){var a,n,i,o=p.getContext("/"+e),d=p._resolveGroup(e);if(o.hasTransientParent()||o.isInactive()){return}if(d.groupId===s||!s){n=p._processChange(e,t,d.groupId,r);n.key=e;a=t.__metadata&&t.__metadata.created?t.__metadata.created:{};i={abort:function(){n._aborted=true}};if(d.groupId in p.mDeferredGroups){p._pushToRequestQueue(p.mDeferredRequests,d.groupId,d.changeSetId,n,a.success,a.error,i,a.refreshAfterChange===undefined?f:a.refreshAfterChange)}}});for(_ in p.mDeferredRequests){m=p.mDeferredRequests[_];for(l in m.changes){o=m.changes[l];for(g=o.length-1;g>=0;g--){n=o[g];if(n.bRefreshAfterChange===undefined){n.bRefreshAfterChange=f}}}}d=p._processRequestQueue(p.mDeferredRequests,s,u,a,e.changeHeaders);if(h){i.abort()}if(Array.isArray(d)&&d.length==0&&u){u({},undefined)}});i={abort:function(){if(d){if(Array.isArray(d)){d.forEach(function(e){e.abort()})}else{d.abort()}}else{h=true}}};return i};$.prototype._updateChangedEntity=function(e,t){var a,s,r,n,i,o,d=this;function u(e,t,a){c(t,function(s){var n=a+"/"+s;if(g(t[s])&&g(e[s])){u(e[s],t[s],n);if(l(t[s])){delete t[s]}}else if(a.endsWith("__metadata")||h(t[s],e[s])&&!d.isLaundering(n)){delete t[s];if(a===o){r=d.oMetadata._getEntityTypeByPath(o);i=r&&d.oMetadata._getNavPropertyRefInfo(r,s);if(i&&t[i.name]){e[i.name]=t[i.name];delete t[i.name]}}}})}if(e in d.mChangedEntities){n=d._getObject("/"+e,null,true);a=d._getObject("/"+e);_(n,t);o="/"+e;s=d.removeInternalMetadata(a).deepPath;u(n,a,o);if(l(a)){delete d.mChangedEntities[e];d.abortInternalRequest(d._resolveGroup(e).groupId,{requestKey:e})}else{d.mChangedEntities[e]=a;a.__metadata={deepPath:s};p(a.__metadata,n.__metadata)}}};$.prototype._discardEntityChanges=function(e,t){var a,s,r=this._resolveGroup(e).groupId,n=this.oMetadata.loaded(),i=this;n.then(function(){i.abortInternalRequest(r,{requestKey:e})});if(t){a=this.getContext("/"+e);a.removeFromTransientParent();this.oCreatedContextsCache.findAndRemoveContext(a);s=this.mChangedEntities[e]&&this.mChangedEntities[e].__metadata.created;this._removeEntity(e);if(s&&s.abort){s.abort($._createAbortedError())}}else{delete this.mChangedEntities[e]}v.removeMessages(this.getMessagesByEntity(e,true));return n};$.prototype.resetChanges=function(e,t,a){return this._resetChanges(e,t,a)};$.prototype.resetChangesWithoutUpdate=function(e,t,a){return this._resetChanges(e,t,a,false)};$.prototype._resetChanges=function(e,t,a,s){var r,n=this.oMetadata.loaded(),i=[],o=this;if(t){n.then(function(){c(o.mDeferredGroups,function(t){if(e){e.forEach(function(e){o.abortInternalRequest(t,{path:e.substring(1)})})}else{o.abortInternalRequest(t)}})})}if(e){c(e,function(e,t){var a,s,r,n,d,u={};if(o.getEntityByPath(t,null,u)){d=u.propertyPath.split("/");n=d[d.length-1];r=u.key;a=o.mChangedEntities[r];if(a){for(s=0;s<d.length-1;s+=1){if(a&&a.hasOwnProperty(d[s])){a=a[d[s]]}else{a=undefined;break}}if(a&&a.hasOwnProperty(n)){delete a[n]}a=o.mChangedEntities[r];if($._isChangedEntityEmpty(a)||!u.propertyPath){i.push(r)}}}});r=i;i.forEach(function(e){r=r.concat(o.getContext("/"+e).getSubContextsAsKey(true))});new Set(r).forEach(function(e){o._discardEntityChanges(e,o.mChangedEntities[e].__metadata.created&&a)})}else{c(this.mChangedEntities,function(e,t){var s=o.getContext("/"+e).isInactive()?false:t.__metadata.created&&a;o._discardEntityChanges(e,s)})}this.getBindings().forEach(function(t){if(t._resetChanges){t._resetChanges(e)}});this.checkUpdate(s===undefined?true:s);return n};$.prototype.setProperty=function(e,t,a,s){var r,n,i,o,d,u,f,p,_,m,y,v,b,C,P,q,R,E,S,T,x,A,U,I,D,O={},k={},H=false,B=this;function L(e,t){c(t,function(a){if(g(t[a])&&g(e[a])){L(e[a],t[a]);if(l(t[a])){delete t[a]}}else if(h(t[a],e[a])){delete t[a]}})}D=this.resolve(e,a);o=this.resolveDeep(e,a);f=this.getEntityByPath(D,null,k);if(!f){return false}E=D.substring(D.lastIndexOf("/")+1);if(E.startsWith("@$ui5.")){throw new Error("Setting a value for an instance annotation starting with '@$ui5' is "+"not allowed: "+E)}y=k.key;C=this._getObject("/"+y,null,true);P=this._getObject(e,a,true);H=C.__metadata.created&&C.__metadata.created.functionImport;if(!this.mChangedEntities[y]){d=f.__metadata;f={};f.__metadata=Object.assign({},d);if(!H&&k.propertyPath.length>0){var F=o.lastIndexOf(k.propertyPath);f.__metadata.deepPath=o.substring(0,F-1)}this.mChangedEntities[y]=f}n=this.mChangedEntities[y];R=k.propertyPath.split("/");for(var w=0;w<R.length-1;w++){if(!n.hasOwnProperty(R[w])){n[R[w]]={}}n=n[R[w]]}n[E]=M.isPlainObject(t)?M.merge({},t):t;if(a&&a.hasTransientParent&&a.hasTransientParent()){O[y]=true;this.checkUpdate(false,s,O);return true}u=this.oMetadata._getEntityTypeByPath(k.key);b=u&&this.oMetadata._getNavPropertyRefInfo(u,E);m=b&&C[b.name]&&C[b.name].__ref;if(m&&b.keys.length===1&&this.oMetadata._getEntityTypeByPath(b.entitySet).key.propertyRef.length===1){if(t===null){S=null}else{v={};b.keys.forEach(function(e){v[e]=f[e]!==undefined?f[e]:C[e]});v[b.keys[0]]=t;S=this.createKey(b.entitySet,v)}n[b.name]={__ref:S}}I=this.oMetadata.loaded();if(f.__metadata.created&&!H){r=this.oCreatedContextsCache.findCreatedContext(D);if(r&&r.isInactive()){r.startActivation();I=Promise.all([I,r.fetchActivated()])}}if(h(t,P)&&!this.isLaundering("/"+y)&&!H){d=this.mChangedEntities[y].__metadata;i=d&&d.created;delete this.mChangedEntities[y].__metadata;if(!i){L(C,this.mChangedEntities[y])}if(l(this.mChangedEntities[y])){delete this.mChangedEntities[y];O[y]=true;this.checkUpdate(false,s,O);I.then(function(){B.abortInternalRequest(B._resolveGroup(y).groupId,{requestKey:y})});return true}this.mChangedEntities[y].__metadata=d}_=this._resolveGroup(y);p=_.groupId;A=this.mRequests;if(p in this.mDeferredGroups){A=this.mDeferredRequests}x=this._processChange(y,this._getObject("/"+y),p);x.key=y;q=n.__metadata&&n.__metadata.created?n.__metadata.created:{};T=this._getRefreshAfterChange(undefined,p);I.then(function(){U={abort:function(){x._aborted=true}};B._pushToRequestQueue(A,p,_.changeSetId,x,q.success,q.error,U,T);B._processRequestQueueAsync(B.mRequests)});O[y]=true;this.checkUpdate(false,s,O);return true};$.prototype._isHeaderPrivate=function(e){switch(e.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false}};$.prototype.setHeaders=function(e){var t={},a=this;this.mCustomHeaders={};if(e){c(e,function(e,s){if(a._isHeaderPrivate(e)){o.warning(this+" - modifying private header: '"+e+"' not allowed!")}else{t[e]=s}});this.mCustomHeaders=t}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders)}};$.prototype._getHeaders=function(e,t){var a={},s=this;if(e){c(e,function(e,t){if(s._isHeaderPrivate(e)){o.warning(this+" - modifying private header: '"+e+"' not allowed!")}else{a[e]=t}})}return p({"sap-cancel-on-close":!!t},this.mCustomHeaders,a,this.oHeaders)};$.prototype.getHeaders=function(){return p({},this.mCustomHeaders,this.oHeaders)};$.prototype._getHeader=function(e,t){var a;for(a in t){if(a.toLowerCase()===e.toLowerCase()){return t[a]}}return null};$.prototype.hasPendingChanges=function(e){var t,a=Object.keys(this.mChangedEntities);t=this.getBindings().some(function(e){return e._hasPendingChanges&&e._hasPendingChanges(a)});t=t||a.length>0;if(!t&&e){t=this.iPendingDeferredRequests>0}return t};$.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0};$.prototype.getPendingChanges=function(){var e,t=M.merge({},this.mChangedEntities);this.getBindings().forEach(function(e){if(e._getPendingChanges){M.merge(t,e._getPendingChanges())}});for(e in t){if(!t[e]){delete t[e]}}return t};$.prototype.updateBindings=function(e){this.checkUpdate(e)};$.prototype.setTokenHandlingEnabled=function(e){this.bTokenHandling=e};$.prototype.setUseBatch=function(e){this.bUseBatch=e};$.prototype.formatValue=function(e,t){return k.formatValue(e,t)};$.prototype.deleteCreatedEntry=function(e){var t,a,s=this;if(e){a=e.getPath().substr(1);t=this._resolveGroup(a).groupId;s.oMetadata.loaded().then(function(){s.abortInternalRequest(t,{requestKey:a})});s._removeEntity(a);v.removeMessages(this.getMessagesByEntity(e.getPath(),true))}};$.prototype.createEntry=function(e,t){var a,s,r,n,d,u,h,f,c,p,l,g,v,b,C,P,q,M,R,E,S,T,x,A,U,I={},D="POST",O=this;function H(e){P=O._addEntity(_({},I));if(!b){O.mChangedEntities[P]=I}return O.getContext("/"+P,f,d,b,e)}function B(){var t;if(h){t=O.oMetadata._getEntityTypeByPath(r.getPath());if(!O.oMetadata._getNavigationPropertyNames(t).includes(e)){throw new Error("Cannot create entity; path '"+e+"' is not a navigation property of '"+t.name+"'")}if(!C){throw new Error("Cannot create entity; deep create on navigation property '"+e+"' with single cardinality is not supported")}}}function L(){var t,n,b,L,F,w,j,N,W,$,K,z,Q=false,V=p,J=T;a=O._isCanonicalRequestNeeded(a);v=Object.assign({},v);A=k._createUrlParamsArray(U);if(!e.startsWith("/")&&!r){e="/"+e}q=O._normalizePath(e,r,a);f=O.resolveDeep(e,r);C=O.oMetadata._isCollection(f);B();c=O.oMetadata._getEntityTypeByPath(q);if(!c){i(c,"No Metadata for collection "+q+" found");return undefined}I=h?{}:O.getForeignKeysFromReferentialConstraints(q);if(typeof M==="object"&&!Array.isArray(M)){I=_(I,M)}F=c.entityType;L=O.oMetadata._getEntitySetByType(c);z=m();P=L.name+"('"+z+"')";w=O.sServiceUrl+"/"+P;if(C){f=f+"('"+z+"')"}if(h){$=O._getObject(r.getPath());s=$.__metadata.created.changeSetId;g=$.__metadata.created.groupId;I.__metadata={type:F,uri:w,created:{changeSetId:s,groupId:g}};n=H(r);r.addSubContext(e,n,C);return n}if(l){v["Content-ID"]=z;T=function(e,a){if(!t){t=e;b=a;return}if(J){e=Object.assign({},t,e);J(e,b)}u()};p=function(e){if(t){b.expandAfterCreateFailed=true;e.expandAfterCreateFailed=true;o.error("Entity creation was successful but expansion of navigation"+" properties failed",e,G);if(J){J(t,b)}u();return}if(!Q){Q=true;if(V){V(e)}}else{e.expandAfterCreateFailed=true;Q=false}}}else{T=function(e,t){if(J){J(e,t)}u()}}W=O._resolveGroup(q);g=g||W.groupId;s=s||W.changeSetId;R=O._getRefreshAfterChange(R,g);K=O._isTransitionMessagesOnly(g);if(K||l){v["sap-messages"]="transientOnly"}I.__metadata={type:F,uri:w,created:{changeSetId:s,error:p,groupId:g,headers:v,key:q.substring(1),refreshAfterChange:R,success:T,urlParameters:U},deepPath:f};d=new y(function(e,t){u=function(){if(!O.oCreatedContextsCache.getCacheInfo(n)){n.resetCreatedPromise()}if(n.hasSubContexts()){O.resetChanges(n.getSubContextsAsPath(),undefined,true)}e()};I.__metadata.created.abort=t});d.catch(function(){});n=H();x=O._createRequestUrlWithNormalizedPath(q,A,O.bUseBatch);E=O._createRequest(x,f,D,v,I);if(l){j=O._getHeaders(undefined,true);if(K){j["sap-messages"]="transientOnly"}N=O._createRequest("$"+z+"?"+k._encodeURLParameters({$expand:l,$select:l}),"/$"+z,"GET",j,null,undefined,undefined,true);N.contentID=z;E.expandRequest=N;E.contentID=z;I.__metadata.created.expandRequest=N;I.__metadata.created.contentID=z}E.key=P;E.created=true;S=O.mRequests;if(g in O.mDeferredGroups){S=O.mDeferredRequests}O.oMetadata.loaded().then(function(){n.fetchActivated().then(function(){var e={abort:function(){if(E){E._aborted=true;if(E.expandRequest){E.expandRequest._aborted=true}}}};O._pushToRequestQueue(S,g,s,E,T,p,e,R);O._processRequestQueueAsync(O.mRequests)})});return n}if(t){M=t.properties;g=t.groupId||t.batchGroupId;s=t.changeSetId;r=t.context;T=t.success;p=t.error;n=t.created;v=t.headers;U=t.urlParameters;R=t.refreshAfterChange;a=t.canonicalRequest;l=t.expand;b=t.inactive}if(l&&!this.bUseBatch){throw new Error("The 'expand' parameter is only supported if batch mode is used")}h=r&&r.isTransient&&r.isTransient();if(h){Object.keys(t).forEach(function(e){if(!j.includes(e)){throw new Error("deep create, unsupported parameter: "+e)}});if(r.isInactive()){throw new Error("deep create, context must not be inactive")}}if(n){this.oMetadata.loaded().then(function(){n(L())})}else if(this.oMetadata.isLoaded()){return L()}else{o.error("Tried to use createEntry without created-callback, before metadata is "+"available!")}return undefined};$.prototype.getForeignKeysFromReferentialConstraints=function(e){const t=this.oMetadata._splitByLastNavigationProperty(e);if(t.lastNavigationProperty){const e=this.oMetadata._getEntityTypeByName(t.pathBeforeLastNavigationProperty);const a=this.oMetadata._getReferentialConstraintsMapping(e,t.lastNavigationProperty.slice(1));const s=this._getObject(t.pathBeforeLastNavigationProperty);if(s){return Object.keys(a).reduce((e,t)=>{if(s[t]){e[a[t]]=s[t]}return e},{})}}return{}};$.prototype._isCreatedEntity=function(e){return!!(e&&e.__metadata&&e.__metadata.created)};$.prototype._normalizePath=function(e,t,a){if(e&&e.indexOf("?")!==-1){e=e.substr(0,e.indexOf("?"))}if(!t&&!e.startsWith("/")){o.fatal(this+" path "+e+" must be absolute if no Context is set")}return this.resolve(e,t,a)||this.resolve(e,t)};$.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange};$.prototype.setRefreshAfterChange=function(e){this.bRefreshAfterChange=e};$.prototype.isList=function(e,t){e=this.resolve(e,t);return e&&e.substr(e.lastIndexOf("/")).indexOf("(")===-1};$.prototype._isMetadataPath=function(e){var t=false;if(e&&e.indexOf("/#")>-1){t=true}return t};$.prototype.isMetaModelPath=function(e){return e.indexOf("##")==0||e.indexOf("/##")>-1};$.prototype._request=function(e,t,a,s,r,n){var i;if(this.bDestroyed){return{abort:function(){}}}var o=this;function d(e){return function(){if(o.aPendingRequestHandles){var t=o.aPendingRequestHandles.indexOf(i);if(t>-1){o.aPendingRequestHandles.splice(t,1)}}if(!(i&&i.bSuppressErrorHandlerCall)){e.apply(this,arguments)}}}i=L.request(e,d(t||L.defaultSuccess),d(a||L.defaultError),s,r,n);if(e.async!==false){this.aPendingRequestHandles.push(i)}return i};$.prototype.destroy=function(){this.bDestroyed=true;T.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var e=this.aPendingRequestHandles.length-1;e>=0;e--){var t=this.aPendingRequestHandles[e];if(t&&t.abort){t.bSuppressErrorHandlerCall=true;t.abort()}}delete this.aPendingRequestHandles}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent)}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent)}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata}delete this.oMetadata;delete this.pMetadataLoaded}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded}if(this.oMessageParser){this.oMessageParser.destroy();delete this.oMessageParser}};$.prototype.setDeferredBatchGroups=function(e){this.setDeferredGroups(e)};$.prototype.setDeferredGroups=function(e){var t=this;this.mDeferredGroups={};c(e,function(e,a){t.mDeferredGroups[a]=a})};$.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups()};$.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups)};$.prototype.setChangeBatchGroups=function(e){c(e,function(e,t){t.groupId=t.batchGroupId});this.setChangeGroups(e)};$.prototype.setChangeGroups=function(e){this.mChangeGroups=e};$.prototype.getChangeBatchGroups=function(){return this.getChangeGroups()};$.prototype.getChangeGroups=function(){return this.mChangeGroups};$.prototype.setMessageParser=function(e){if(!(e instanceof C)){o.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this}e.setProcessor(this);this.oMessageParser=e;return this};$.prototype._parseResponse=function(e,t,a,s){try{if(!this.oMessageParser){this.oMessageParser=new D(this.sServiceUrl,this.oMetadata,!!this.bPersistTechnicalMessages);this.oMessageParser.setProcessor(this)}this.oMessageParser.parse(e,t,a,s,this.bIsMessageScopeSupported)}catch(e){o.error("Error parsing OData messages: "+e)}};$.prototype.callAfterUpdate=function(e){this.aCallAfterUpdate.push(e)};$.prototype.getMetaModel=function(){var e=this;if(!this.oMetaModel){this.oMetaModel=new I(this.oMetadata,this.oAnnotations,this);this.oMetaModel.loaded().then(function(){e.bMetaModelLoaded=true;e.checkUpdate(false,false,null,true)},function(e){var t=e.message,a;if(!t&&e.xmlDoc&&e.xmlDoc.parseError){t=e.xmlDoc.parseError.reason;a=e.xmlDoc.parseError.srcText}o.error("error in ODataMetaModel.loaded(): "+t,a,G)})}return this.oMetaModel};$.prototype.getOriginalProperty=function(e,t){return this._getObject(e,t,true)};$.prototype.getEntityByPath=function(e,t,a){var s,r=T.prototype.resolve.call(this,e,t);if(!r){return null}var n=r.split("/"),i=null,o=[];while(n.length>0){var d=n.join("/"),u=this._getObject(d);if(g(u)){s=this._getKey(u);if(s){i=u;break}}o.unshift(n.pop())}if(i){a.propertyPath=o.join("/");a.key=s;return i}return null};$.prototype.resolveFromCache=function(e){if(!this.mPathCache){return undefined}var t,a="",s,r,n;s=this.mPathCache[e]?this.mPathCache[e].canonicalPath:undefined;if(e&&s!==e){t=s||e;if(!s){n=t.lastIndexOf("/");a=t.substr(n);t=t.substr(0,n)}r=this.resolveFromCache(t);if(r&&r!==t){s=r+a}}return s};$.prototype.resolve=function(e,t,a){var s=T.prototype.resolve.call(this,e,t);if(s&&!this._isMetadataPath(s)&&a){var r=this.resolveFromCache(s);if(!r){r=this.oMetadata._calculateCanonicalPath(s);r=this.resolveFromCache(r)||r}this._writePathCache(s,r);return r}return s};$.prototype.resolveDeep=function(e,t){var a=T.prototype.resolve.call(this,e,t);if(e&&!e.startsWith("/")){a=t?t.sDeepPath+"/"+e:a}if(e===""){a=t?t.sDeepPath:a}return a};$.prototype.isLaundering=function(e,t){var a=this.resolve(e,t);return a in this.mLaunderingState&&this.mLaunderingState[a]>0};$.prototype.increaseLaundering=function(e,t){if(!g(t)){return}for(var a in t){if(a==="__metadata"){continue}var s=t[a];if(g(s)){this.increaseLaundering(e+"/"+a,s)}else{var r=e+"/"+a;if(!(r in this.mLaunderingState)){this.mLaunderingState[r]=0}this.mLaunderingState[r]++}}if(!(e in this.mLaunderingState)){this.mLaunderingState[e]=0}this.mLaunderingState[e]++};$.prototype.decreaseLaundering=function(e,t){if(!g(t)){return}for(var a in t){if(a==="__metadata"){continue}var s=t[a],r=e+"/"+a;if(g(s)){this.decreaseLaundering(r,s)}else if(r in this.mLaunderingState){this.mLaunderingState[r]--;if(this.mLaunderingState[r]===0){delete this.mLaunderingState[r]}}}this.mLaunderingState[e]--;if(this.mLaunderingState[e]===0){delete this.mLaunderingState[e]}};$.prototype._getRefreshAfterChange=function(e,t){if(e===undefined&&!(t in this.mDeferredGroups)){return this.bRefreshAfterChange}return e};$.prototype.getMessagesByEntity=function(e,t){var a=e,s=[],r;function n(e){var a=[];for(var s=0;s<e.length;s++){if(!t||t&&!e[s].persistent){a.push(e[s])}}return a}if(!a.startsWith("/")){a="/"+a}if(this.mMessages){for(r in this.mMessages){if(typeof a=="string"&&a.length>0&&r.startsWith(a)){s=s.concat(n(this.mMessages[r]))}}return s}return null};$.prototype._cacheSupported=function(e){var t=/\/~[\w\-]+~[A-Z0-9]?/;var a=[e];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}a=a.concat(this.sAnnotationURI)}a=a.filter(function(e){return e.indexOf("sap-context-token")===-1});a=a.filter(function(e){return!t.test(e)});return a.length===0?true:false};$.prototype._getAnnotationCacheKey=function(e){var t=this.bSkipMetadataAnnotationParsing||this.bIgnoreAnnotationsFromMetadata,a;if(this.bUseCache){if(!t){a=e+"#annotations"}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}this.sAnnotationURI=this.sAnnotationURI.map(function(e){return e+"#annotations"});a=t?this.sAnnotationURI.join("_"):a+"_"+this.sAnnotationURI.join("_")}}return a};$.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests};$.prototype._decreaseDeferredRequestCount=function(e){if(e.deferred){this.iPendingDeferredRequests--}};$.prototype.enableCanonicalRequests=function(e){this.bCanonicalRequests=!!e};$.prototype.getMessageScope=function(){return this.sMessageScope};$.prototype.setMessageScope=function(e){if(e!==A.RequestedObjects&&e!==A.BusinessObject){throw new Error("Unsupported message scope: "+e)}this.sMessageScope=e};$.prototype.messageScopeSupported=function(){var e=this;return this.metadataLoaded().then(function(){return e.bIsMessageScopeSupported})};$.prototype.getContext=function(e,a,s,r,n){var i=this.mContexts[e];if(!i){i=this.mContexts[e]=new t(this,e,a,s,r,n)}else{i.setDeepPath(a||i.getDeepPath()||e)}return i};$.prototype.hasContext=function(e){return this.mContexts[e]};$.prototype.removeInternalMetadata=function(e){var t,a,s,r,n;if(e&&e.__metadata){t=e.__metadata.created;a=e.__metadata.deepPath;s=e.__metadata.invalid;delete e.__metadata.created;delete e.__metadata.deepPath;delete e.__metadata.invalid}for(r in e){n=e[r];if(Array.isArray(n)){n.forEach($.prototype.removeInternalMetadata)}else if(typeof n==="object"){$.prototype.removeInternalMetadata(n)}}return{created:t,deepPath:a,invalid:s}};$.prototype._isCanonicalRequestNeeded=function(e){if(e!==undefined){return!!e}else{return!!this.bCanonicalRequests}};$.prototype.filterMatchingMessages=function(e,t){var a=this;return this.mMessages[e].filter(function(e){return a.isMessageMatching(e,t)})};$.prototype.isMessageMatching=function(e,t){var a=t.length;return e.aFullTargets.some(function(e){return e===t||e.startsWith(t)&&(t==="/"||e[a]==="/"||e[a]==="(")})};$.prototype.getMessages=function(e){return this.getMessagesByPath(e.sDeepPath,true).sort(b.compare)};$.prototype.getDeepPathForCanonicalPath=function(e){var t,a,n,i,o,d,u,h=e.slice(e.indexOf("("));o=this.aBindings.filter(function(e){return(e instanceof s||e instanceof r)&&e.isResolved()});for(d=0,u=o.length;d<u;d+=1){t=o[d];n=this.resolveDeep(t instanceof r?t.sPath+h:t.sPath,t.oContext);a=this.resolveFromCache(n);if(a===e){if(i&&i!==n){return undefined}i=n}}return i};$.prototype.getPersistTechnicalMessages=function(){return this.bPersistTechnicalMessages};$.prototype.setPersistTechnicalMessages=function(e){e=!!e;if(this.bPersistTechnicalMessages===e){return}if(this.bPersistTechnicalMessages!==undefined){o.warning("The flag whether technical messages should always be treated as persistent"+" has been overwritten to "+e,undefined,G)}this.bPersistTechnicalMessages=e;if(this.oMessageParser){this.oMessageParser._setPersistTechnicalMessages(e)}};$.prototype.createCodeListModelParameters=function(e){e=e||{};return{defaultCountMode:x.None,disableSoftStateHeader:true,headers:e.headers&&Object.assign({},e.headers),json:e.json,metadataUrlParams:e.metadataUrlParams&&Object.assign({},e.metadataUrlParams),persistTechnicalMessages:e.persistTechnicalMessages,serviceUrl:this.sServiceUrl,serviceUrlParams:e.serviceUrlParams&&Object.assign({},e.serviceUrlParams),tokenHandling:false,useBatch:false,warmupUrl:e.warmupUrl}};$.prototype.getCodeListModelParameters=function(){return this.mCodeListModelParams};$.prototype.getMetadataUrl=function(){return this.sMetadataUrl};$._createAbortedError=function(){return{aborted:true,headers:{},message:"Request aborted",responseText:"",statusCode:0,statusText:"abort"}};$.prototype._getCreatedContextsCache=function(){return this.oCreatedContextsCache};$._isChangedEntityEmpty=function(e){return Object.keys(e).every(function(e){return e==="__metadata"})};$.prototype._addSubEntitiesToPayload=function(e,t){var a,s,r,n,i=e.getSubContexts(),o=this;function d(e){var t=M.merge({},o._getObject(e.getPath()));delete t.__metadata;return t}for(s in i){r=i[s];if(Array.isArray(r)){t[s]=[];for(a=0;a<r.length;a+=1){n=d(r[a]);t[s].push(n);this._addSubEntitiesToPayload(r[a],n)}}else{n=d(r);t[s]=n;this._addSubEntitiesToPayload(r,n)}}};$.prototype._isTransitionMessagesOnly=function(e){return this.oTransitionMessagesOnlyGroups.has(e)};$.prototype.setTransitionMessagesOnlyForGroup=function(e,t){var a=t?"add":"delete";this.oTransitionMessagesOnlyGroups[a](e)};return $});
//# sourceMappingURL=ODataModel.js.map